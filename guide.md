# 项目总结：宫腔镜下子宫内膜病变智能活检导航系统

## 1. 项目背景与痛点

**临床场景**：  
宫腔镜检查用于诊断子宫内膜癌、不典型增生、息肉等病变。

**核心痛点**：  
- 早期癌变与不典型增生在镜下形态极为相似，且病变呈灶状分布。  
- 经验不足的医生容易出现 **“漏诊”或“取样误差”**（未夹取病变最重部位，导致病理定级偏低）。

**项目目标**：  
利用多模态大模型（LMM）不仅做“诊断”，更要做 **“导航”** —— 指导医生 **“去哪里夹”** 及其背后的 **“医学依据”**。

---

## 2. 核心工程方法论 (Engineering Methodology)

为在**不进行昂贵模型微调（Fine-tuning）**的前提下达到超越专家的效果，采用以下两类工程化优化策略：

### A. 不需要数据的方法 (Data-Independent)

| 方法名称                                     | 技术原理                                                                                   | 解决了什么问题                                      | 论文创新点                                                          |
| -------------------------------------------- | ------------------------------------------------------------------------------------------ | --------------------------------------------------- | ------------------------------------------------------------------- |
| **Set-of-Mark (SoM)**<br>（标记集提示法）    | 先利用通用分割模型（如 SAM）自动圈出图像中的独立结构并编号（1,2,3...），让大模型选择编号。 | 解决大模型对像素坐标（x,y）不敏感、定位不准的问题。 | **视觉-语言对齐创新**：将回归问题转化为分类问题，显著提升定位精度。 |
| **Visual Prompting**<br>（视觉提示/网格法）  | 在原图上覆盖  $ 5 \times 5 $  网格或半透明热力层，辅助模型定位。                           | 降低模型理解空间位置的难度。                        | **低成本工程优化**：简单预处理带来显著效果提升。                    |
| **Chain-of-Thought (CoT)**<br>（思维链推理） | 强制模型分三步走：<br>1. 形态描述 →<br>2. 病理特征推理 →<br>3. 活检决策。                  | 避免“黑盒”决策，提供可解释性。                      | **临床可信度**：模拟人类专家“看图-分析-决策”的思维路径。            |
| **Coarse-to-Fine**<br>（由粗到细策略）       | 1. 全局扫描找可疑区 →<br>2. 自动裁剪放大 →<br>3. 局部精修判断。                            | 解决宫腔镜大图中小病灶细节丢失的问题。              | **多尺度分析**：模拟医生推近镜头观察的操作。                        |
| **Multi-Persona Debate**<br>（多角色辩论）   | 让模型分饰“激进派（肿瘤科）”与“保守派（病理科）”，最终由裁判总结。                         | 减少对中间状态（如不典型增生）的误判。              | **对抗性推理**：通过内部博弈提高诊断鲁棒性。                        |

### B. 需要数据的方法 (Data-Dependent)

| 方法名称                                       | 技术原理                                                                         | 数据需求                     | 论文创新点                                                        |
| ---------------------------------------------- | -------------------------------------------------------------------------------- | ---------------------------- | ----------------------------------------------------------------- |
| **Visual RAG**<br>（视觉检索增强）             | “以图搜图”：新图输入后，系统从数据库检索3张最相似的已确诊/专家标注图片作为参考。 | 需建立一个几百例的精标图库。 | **循证AI (Evidence-Based)**：模拟医生查阅图谱和历史病例的过程。   |
| **Visual ICL**<br>（视觉上下文学习）           | 在 Prompt 中直接嵌入几组对比鲜明的范例（如：“这种血管是癌”，“那种是息肉”）。     | 仅需10–20张典型教学图片。    | **少样本学习 (Few-Shot)**：证明大模型具有极强的即时学习迁移能力。 |
| **Knowledge Base Injection**<br>（知识库注入） | 建立特征文本库（如“异型血管”、“脑回状突起”的标准定义），辅助模型判断。           | 整理几十条标准征象描述。     | **知识增强**：将医学指南标准直接注入推理过程。                    |

---

## 3. 推荐技术路线组合 (The "Winning" Pipeline)

建议在论文中采用 **Set-of-Mark (SoM) + Visual RAG** 的组合拳。

### 架构逻辑：

- **输入层**：患者宫腔镜图像。  
- **预处理层 (SoM)**：调用 Segment Anything Model (SAM) 对图像中的血管团、内膜增厚区进行自动分割并打上数字标签。  
- **记忆层 (RAG)**：系统提取图像特征，从数据库中检索出 **3 张相似的确诊病例**（且带有专家标注的“最佳活检点”）。  
- **推理层 (LLM)**：将 `[打标的新图 + 3 张参考图 + 提示词]` 喂给 GPT-4o / Claude 3.5。  
  - **Prompt 示例**：  
    > “参考这3张相似病例的活检选择，请判断新图中编号为 #5 的区域是否具有类似的恶性特征？是否建议在此处活检？”  
- **输出层**：输出活检建议（编号）+ 决策解释（文本）。

---

## 4. 论文撰写与评估指标

### 推荐题目

- **英文**：  
  *Refining Hysteroscopic Biopsy Strategy: A Training-Free Framework via Visual Retrieval-Augmented Generation and Set-of-Mark Prompting*

- **中文**：  
  *基于视觉检索增强与标记集提示的大模型宫腔镜精准活检导航研究*

### 关键评估指标 (Metrics)

为证明方法“效果好”，重点关注：

- **IoU (Intersection over Union)**：AI推荐的活检框与专家金标准框的重合度（**最重要的指标**）。  
- **Diagnostic Accuracy**：良恶性分类准确率。  
- **Alignment Score**：请医生对 AI 生成的“解释性文本”进行打分（1–5 分），评价其是否符合医学逻辑。  
- **A/B Test (人机对比)**：低年资医生 vs. (低年资医生 + AI)，证明 AI 能显著提升新手水平。

---

## 5. 下一步行动清单 (To-Do List)

- **数据收集（核心）**：  
  - 收集 **50–100 例**宫腔镜图像。  
  - **关键动作**：请科室主任/专家在图上圈出 **“如果是你，你会夹哪里”**（作为金标准）。

- **环境搭建**：  
  - 准备 Python 环境。  
  - 熟悉 OpenAI API（或 Claude API）的调用。  
  - 下载 Meta 的 **Segment Anything Model (SAM)** 用于 SoM 预处理。

- **小规模测试**：  
  - 先拿 **5 张图**跑通流程，验证模型能否根据 Prompt 准确选出数字编号。